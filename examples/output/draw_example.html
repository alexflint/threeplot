<html>
<head>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r69/three.min.js"></script>
<script src="https://dl.dropboxusercontent.com/u/3587259/Code/Threejs/OrbitControls.js"></script>
<style>
body {
  color: #000;
  font-family:Monospace;
  font-size:13px;
  text-align:center;
  font-weight: bold;

  background-color: #fff;
  margin: 0px;
  overflow: hidden;
}
</style>
</head>
<body>
<div id="container"></div> 
<script type="text/javascript">
var spec = {
    "objects": [
        {
            "line_color": "0xff0000",
            "line_width": 2,
            "marker_color": "0xff0000",
            "marker_size": null,
            "line_style": "solid",
            "type": "series",
            "vertices": [
                [
                    -10.0,
                    -1.8185948536513634,
                    0.0
                ],
                [
                    -7.7777777777777777,
                    -1.9997677233882047,
                    0.0
                ],
                [
                    -5.5555555555555554,
                    -1.7923844020599127,
                    0.0
                ],
                [
                    -3.333333333333333,
                    -1.236739606139474,
                    0.0
                ],
                [
                    -1.1111111111111107,
                    -0.44079548691224441,
                    0.0
                ],
                [
                    1.1111111111111107,
                    0.44079548691224441,
                    0.0
                ],
                [
                    3.3333333333333339,
                    1.2367396061394742,
                    0.0
                ],
                [
                    5.5555555555555571,
                    1.7923844020599129,
                    0.0
                ],
                [
                    7.7777777777777786,
                    1.9997677233882047,
                    0.0
                ],
                [
                    10.0,
                    1.8185948536513634,
                    0.0
                ]
            ]
        },
        {
            "line_color": "0x00ff00",
            "line_width": 5,
            "marker_color": "0xff0000",
            "marker_size": null,
            "line_style": "dashed",
            "type": "series",
            "vertices": [
                [
                    -10.0,
                    3.1814051463486366,
                    0.0
                ],
                [
                    -7.7777777777777777,
                    3.0002322766117953,
                    0.0
                ],
                [
                    -5.5555555555555554,
                    3.2076155979400873,
                    0.0
                ],
                [
                    -3.333333333333333,
                    3.7632603938605262,
                    0.0
                ],
                [
                    -1.1111111111111107,
                    4.5592045130877557,
                    0.0
                ],
                [
                    1.1111111111111107,
                    5.4407954869122443,
                    0.0
                ],
                [
                    3.3333333333333339,
                    6.2367396061394746,
                    0.0
                ],
                [
                    5.5555555555555571,
                    6.7923844020599127,
                    0.0
                ],
                [
                    7.7777777777777786,
                    6.9997677233882047,
                    0.0
                ],
                [
                    10.0,
                    6.8185948536513639,
                    0.0
                ]
            ]
        },
        {
            "line_color": "0x555500",
            "line_width": 10,
            "marker_color": "0xff0000",
            "marker_size": null,
            "line_style": "dotted",
            "type": "series",
            "vertices": [
                [
                    -10.0,
                    -6.8185948536513639,
                    0.0
                ],
                [
                    -7.7777777777777777,
                    -6.9997677233882047,
                    0.0
                ],
                [
                    -5.5555555555555554,
                    -6.7923844020599127,
                    0.0
                ],
                [
                    -3.333333333333333,
                    -6.2367396061394738,
                    0.0
                ],
                [
                    -1.1111111111111107,
                    -5.4407954869122443,
                    0.0
                ],
                [
                    1.1111111111111107,
                    -4.5592045130877557,
                    0.0
                ],
                [
                    3.3333333333333339,
                    -3.7632603938605258,
                    0.0
                ],
                [
                    5.5555555555555571,
                    -3.2076155979400873,
                    0.0
                ],
                [
                    7.7777777777777786,
                    -3.0002322766117953,
                    0.0
                ],
                [
                    10.0,
                    -3.1814051463486366,
                    0.0
                ]
            ]
        },
        {
            "line_color": "0xff0000",
            "line_width": null,
            "marker_color": "0x0000ff",
            "marker_size": 5,
            "line_style": "solid",
            "type": "series",
            "vertices": [
                [
                    1.2229896542827721,
                    0.33948327352455321,
                    -0.45266116653579047
                ],
                [
                    -1.7451890023811474,
                    -0.67754194473238805,
                    -0.29795989441609833
                ],
                [
                    -0.19976355363635975,
                    1.0943813823406054,
                    0.51294507925159316
                ],
                [
                    -1.7126988387541848,
                    0.73930736309941658,
                    -1.2322021445861744
                ],
                [
                    -1.0147849738515862,
                    2.5233976852111564,
                    0.22290089428157797
                ],
                [
                    0.038992213816467426,
                    -1.8278407200189253,
                    -0.99306681621504755
                ],
                [
                    -0.018665384506741399,
                    1.6972879246372605,
                    -2.1436539933046754
                ],
                [
                    -1.6157512012093502,
                    0.33066961200805062,
                    -1.4217154064140585
                ],
                [
                    -0.27240391742645459,
                    -2.1397468388323651,
                    0.3083040305307535
                ],
                [
                    -0.67134701648012207,
                    0.70130240415462763,
                    -1.0771384878535823
                ],
                [
                    -1.9861979600879336,
                    -0.22664204081041364,
                    0.96351126548538479
                ],
                [
                    1.0819032467426071,
                    0.51272552798893078,
                    1.6090965080850594
                ],
                [
                    1.9805252199946088,
                    -1.1020540914388561,
                    -0.30242611839148315
                ],
                [
                    0.54070174526356474,
                    0.12135961255846557,
                    -0.81546804806471973
                ],
                [
                    1.0078960715354846,
                    -0.85277121648086474,
                    -0.67255153452920258
                ],
                [
                    1.7436755092740732,
                    0.84849890651743876,
                    -0.051440264238579503
                ],
                [
                    1.2060277104461345,
                    1.520781631457149,
                    0.73638838462636613
                ],
                [
                    0.93747125477368454,
                    0.86793767749347916,
                    0.24123234567177779
                ],
                [
                    1.1932751192334012,
                    -0.36039072948907153,
                    -0.94156557898988147
                ],
                [
                    -1.0701809319625426,
                    -0.77263854818287758,
                    -0.56542996510158106
                ]
            ]
        }
    ]
};
</script>
<script type="text/javascript">
var container, stats;
var camera, controls, scene, renderer;
var cross;

init();
animate();

function assert(condition, message) {
    if (!condition) {
        message = message || "Assertion failed";
        if (typeof Error !== "undefined") {
            throw new Error(message);
        }
        throw message; // Fallback
    }
}

function createObjectsFromSpec(spec) {
  assert(spec['type'] == 'series', 'Only type="series" is currently supported');
  objects = [];

  // Create the geometry
  geometry = new THREE.Geometry();
  for (var i = 0; i < spec['vertices'].length; ++i) {
    v = spec['vertices'][i];
    assert(v.length == 3, 'Expected vertices length 3');
    geometry.vertices.push(new THREE.Vector3(v[0], v[1], v[2]));
  }

  // Create the line
  if (spec['line_width'] != null) {
    var stipple = spec['line_style'];
    var material;
    if (stipple == 'solid') {
      material = new THREE.LineBasicMaterial({
        'linewidth': spec['line_width'],
        'color': parseInt(spec['line_color'])
      });
    } else if (stipple == 'dashed') {
      material = new THREE.LineDashedMaterial({
        'linewidth': spec['line_width'],
        'color': parseInt(spec['line_color']),
        'dashSize': 3,
        'gapSize': 1,
      });
    } else if (stipple == 'dotted') {
      material = new THREE.LineDashedMaterial({
        'linewidth': spec['line_width'],
        'color': parseInt(spec['line_color']),
        'dashSize': 1,
        'gapSize': 1,
      });
    } else {
      throw new Error('Unrecognized line style: '+stipple);
    }

    geometry.computeLineDistances();  // necessary for dots and dashes to work
    objects.push(new THREE.Line(geometry, material));
  }

  // Create the point cloud
  if (spec['marker_size'] != null) {
    var material = new THREE.PointCloudMaterial({
      'color': parseInt(spec['marker_color']),  // colors are sent as strings like "0xff00ff"
      'size': spec['marker_size'],
      'sizeAttenuation': false,
    });
    objects.push(new THREE.PointCloud(geometry, material));
  }

  return objects;
}

function init() {
  camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
  camera.position.z = 50;

  controls = new THREE.OrbitControls(camera);
  controls.addEventListener('change', render);

  scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2( 0xcccccc, 0.002 );

  // Add the X-Y grid
  //plane_geometry = new THREE.PlaneGeometry({{diameter}}, {{diameter}}, {{num_grid_cells}}, {{num_grid_cells}});
  plane_geometry = new THREE.PlaneGeometry(40, 40, 40, 40);
  plane_material = new THREE.MeshBasicMaterial({color: 0xaaaaaa, wireframe: true});
  plane = new THREE.Mesh(plane_geometry, plane_material);
  scene.add(plane);

  // Add the polyline
  // var line_material = new THREE.LineBasicMaterial({
  // 	color: 0x0000ff,
  // 	linewidth: 4
  // });

  // var line_geometry = new THREE.Geometry();
  // {% for vertex in vertices %}
  // 	line_geometry.vertices.push(new THREE.Vector3({{ vertex[0] }}, {{ vertex[1] }}, {{ vertex[2] }}));
  // {% endfor %}
  // var line = new THREE.Line(line_geometry, line_material);
  // scene.add(line);

  // Create a set objects from the spec
  object_specs = spec['objects'];
  for (var i = 0; i < object_specs.length; ++i) {
    var objects = createObjectsFromSpec(object_specs[i]);
    for (var j = 0; j < objects.length; ++j) {
      console.log('adding an object');
      console.log(objects[j]);
      scene.add(objects[j]);
    }
  }

  // Create renderer
  renderer = new THREE.WebGLRenderer( { antialias: false } );
  renderer.setClearColor( scene.fog.color, 1 );
  renderer.setSize( window.innerWidth, window.innerHeight );

  container = document.getElementById( 'container' );
  container.appendChild( renderer.domElement );

  window.addEventListener( 'resize', onWindowResize, false );
}

function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize( window.innerWidth, window.innerHeight );
  render();
}

function animate() {
  requestAnimationFrame( animate );
  controls.update();
}

function render() {
  renderer.render( scene, camera );
}

</script>
</body>
</html>
